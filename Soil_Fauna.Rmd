---
title: "Soil Fauna"
description: |
  Tullgren Extraction of Soil Meso and Macro Fauna
output:
    distill::distill_article:
      toc: true
      toc_depth: 3
---

![](media/gallery/Cricket.jpg)


Soil invertebrates are incredibly diverse. To put things in perspective: Perching birds (this includes more than half of all bird species worldwide) are in the single order Passeriformes. A single soil sample from a mature forest can contain more than twenty different *orders* of animals! Most soil organisms in the tropics are undescribed species - if you look at a sample under the microscope you are likely to be the first human to ever lay eyes on at least a few species. These tiny creature also play a critical role in the carbon cycle, contributing to decomposition of plant material and cycling nutrients in the soil.


Important for the context of holistic biodiversity monitoring, soil fauna are very location-specific. A mammal observation at a particular point does not necessarily give too much information about the quality of habitat at that point for the mammal - the mammal could just be passing through between places that it actually eats, sleeps and mates. On the other hand, soil fauna have vastly smaller home ranges, and in all likelihood spend their entire lives within a few meters of the sampling point. So, in a patchy landscape with a lot of disturbance they are better indicators of conditions at a particular sampling point.


Brief summary of what I will be doing with my soil invert data:

- Clean up and prepare for vegan R package

- Calculate invertebrate richness at each sampling point, as well as abundance of all taxa across points and land use types

- Calculate Shannon, Simpson and other diversity indices for each land use type

- Run some ordinations to look at community composition differences between land use types.

- Visualize abundance for all orders in relation to land use to see which are most sensitive. 

- If I have enough temperature data from this first round of sampling see if temperature mediates invertebrate response to land use (I suspect it does). The moisture data is unfortunately pretty low resolution, but that probably also plays a very important role. 


### Data cleanup 

Here is a .csv file with raw data for the invert pilot study:

```{r echo=FALSE}
xfun::embed_file('media/working directory/data/Soil invert data.csv')
```  



This spreadsheet is a combination of the invertebrate abundance data and the collection/extraction metadata, in long format. I will start with some clean up and organization. This involves making sure that R reads my dates as dates, converting my data to long format, splitting the dataset in two (one with unknowns and one without), correcting abundance data for sample mass, and splitting the data into absolute and relative abundance. I use absolute abundance data for calculating diversity indices and relative abundance for community structure modelling. 

<details markdown="1">
<summary><strong>Click here</strong> for code </summary>

```{r setup, message=FALSE, results = 'hide'}

data <- read.csv('media/working directory/data/soil invert data.csv')

#load packages

library(ggplot2)
library(tidyr)
library(gridExtra)
library('funrar')
library(lubridate)
library(viridis)

## Initial cleanup, organization

#make dates recognizable by R
data$collect.date <- ymd(data$collect.date)

#Add 0 abundance for unobserved taxa
data$count[is.na(data$count)] <- 0

#remove excess rows from dataframe
data<-data[which(complete.cases(data$collect.date)),]

#create dataset with unknowns (for total abundance)
data.unknown<-data

#create dataset without unknowns (for diversity and community composition)
data <- subset(data, !taxon == "Unknown",)

#make my data wide for vegan package
wide.data <- data %>%
  pivot_wider(names_from = taxon, values_from = count)

#make same wide dataframe for data with unknowns
wide.data.unknown <- data.unknown %>%
  pivot_wider(names_from = taxon, values_from = count)

#Splitting data frame into count and environmental data
wide.data2<-wide.data[,-c(1:12)]     
wide.data3<-wide.data[,-c(13:66)]
wide.data.unknown2<-wide.data.unknown[,-c(1:12)]
wide.data.unknown3<-wide.data.unknown[,-c(13:67)]

# Converting to count per dry mass

#converting to count/1000g
wide.data2 <- (1000/wide.data3$dry.mass)*wide.data2
wide.data.unknown2 <- (1000/wide.data.unknown3$dry.mass)*wide.data.unknown2

#Next I convert mass-corrected absolute abundance to relative abundance, which is used later for total abundance, individual taxon abundance, and community structure modelling. 

#Before the conversion I create data frames backing up the mass-corrected absolute count data for diversity index calculations. 

#Creating versions of the count data that are corrected for mass, but not made relative (for diversity indexes)
wide.data.absolute <- wide.data2
wide.data.unknown.absolute <- wide.data.unknown2

#reincorporating, and duplicating mass-corrected absolute count data (only doing it for unknowns because this data frame will be used for abundance)
wide.data.unknown[,c(13:67)] <- wide.data.unknown.absolute
wide.data.unknown.absolute2 <- wide.data.unknown

#converting absolute to relative abundance
wide.data2 <- as.matrix(wide.data2)
wide.data.unknown2 <- as.matrix(wide.data.unknown2)
wide.data2 <- make_relative(wide.data2)
wide.data.unknown2 <- make_relative(wide.data.unknown2)
wide.data2 <- as.data.frame(wide.data2)
wide.data.unknown2 <- as.data.frame(wide.data.unknown2)

#reincorporating mass-corrected relative count data into original data frame
wide.data[,c(13:66)] <- wide.data2
wide.data.unknown[,c(13:67)] <- wide.data.unknown2

```

</details>


Next up I'll calculate richness, evenness, total abundance, and several diversity indices using the ['vegan'](https://cran.r-project.org/web/packages/vegan/index.html) R package. I use absolute abundance to calculate these metrics.


<details markdown="1">
<summary><strong>Click here</strong> for code </summary>
```{r, message=FALSE, results = 'hide'}
library(vegan)

taxa <- specnumber(wide.data.absolute)                  #Tallying number of taxa
shannon<-diversity(wide.data.absolute)                  #Shannon diversity index
simpson<- diversity(wide.data.absolute, "simpson")      #Simpson diversity index
J<-shannon/log(taxa)                                    #Pielou's evenness
abundance<-rowSums(wide.data.unknown.absolute)          #total absolute abundance per 1000g (including unknowns)

data.summary<-data.frame(wide.data3,taxa, abundance, J, shannon, simpson)

diversity.indices <- data.summary[,c(1:2,13:17)]

```
</details>

Here's what that data looks like:

```{r, echo=FALSE}
knitr::kable(diversity.indices[1:10, ], format = "markdown")

```

Taxa is the number of unique taxa found in each sample (richness/alpha diversity), abundance is total (mass-corrected) abundance of soil fauna, J is Pielou's evenness (how evenly distributed abundance is between the taxa; species dominance rather than diversity), and Shannon and Simpson are two different diversity indices, ways of conceptualizing diversity that combine abundance and richness. The Simpson index is more heavily influenced by dominant species, while the Shannon index is more heavily influenced by rare species. Going forward I will use Shannon to represent diversity, but if we want we can easily swap in Simpson or something else. Note: sample 53 is anomalous. Never have I seen a mature forest sample with so few inverts. Maybe the reason will become apparent after soil chemistry analysis, or there was an error of some kind during extraction/sample processing.

Let's summarize averages for each land use type:

```{r, echo=FALSE}
subset.mature <- subset(data.summary, land.use == "mature")
subset.nat.regen <- subset(data.summary, land.use == "nat.regen")
subset.reforestation <- subset(data.summary, land.use == "reforestation")
subset.teak <- subset(data.summary, land.use == "teak")
subset.pasture <- subset(data.summary, land.use == "pasture")


land.use <- c('mature', 'nat.regen', 'reforestation', 'teak', 'pasture')
taxa <- c(mean(subset.mature$taxa),
          mean(subset.nat.regen$taxa), 
          mean(subset.reforestation$taxa),      
          mean(subset.teak$taxa),
          mean(subset.pasture$taxa))
abundance <- c(mean(subset.mature$abundance),
          mean(subset.nat.regen$abundance), 
          mean(subset.reforestation$abundance),      
          mean(subset.teak$abundance),
          mean(subset.pasture$abundance))
J <- c(mean(subset.mature$J),
          mean(subset.nat.regen$J), 
          mean(subset.reforestation$J),      
          mean(subset.teak$J),
          mean(subset.pasture$J))
shannon <- c(mean(subset.mature$shannon),
          mean(subset.nat.regen$shannon), 
          mean(subset.reforestation$shannon),      
          mean(subset.teak$shannon),
          mean(subset.pasture$shannon))
simpson <- c(mean(subset.mature$simpson),
          mean(subset.nat.regen$simpson), 
          mean(subset.reforestation$simpson),      
          mean(subset.teak$simpson),
          mean(subset.pasture$simpson))

mean.values <- data.frame(land.use, taxa, abundance, J, shannon, simpson)

knitr::kable(mean.values, format = "markdown")
```
Now let's visualize it.


### Total abundance 

```{r, echo=FALSE, message = FALSE, warning = FALSE}

##### Abundance
ggplot(data=mean.values, aes(x=land.use, y=abundance, fill=land.use)) +
  geom_bar(stat="identity", position=position_dodge(), aes(x = factor(land.use, level = land.use)), width = .5, show.legend = FALSE)+
  #scale_fill_brewer(palette="Paired")+ 
  labs(title="Total abundance of soil fauna", x="Land Use Type", y = "Mean abundance (count/1kg dry soil)")+
  theme(text=element_text(family="Arial")) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", begin = .3,end = .75,)+
  theme_minimal()+ theme(plot.title = element_text(hjust = 0.5))
```

Abundance data is corrected for mass to give values of density per 1000g dry soil. The soil moisture values are based on air-dried samples and mass was recorded with a kitchen scale (low resolution), so moisture is a potential source of error here.

Moisture has a large influence on mass, and can vary considerably (30-50% in the wet season in my experience), so this is a considerable source of error.


### Taxonomic Richness

```{r, echo=FALSE, message = FALSE, warning = FALSE}

##### Richness
ggplot(data=mean.values, aes(x=land.use, y=taxa, fill=land.use)) +
  geom_bar(stat="identity", position=position_dodge(), aes(x = factor(land.use, level = land.use)), width = .5, show.legend = FALSE)+
  #scale_fill_brewer(palette="Paired")+ 
  labs(title="Taxonomic richness of soil fauna", x="Land Use Type", y = "Ordinal taxonomic richness")+
  theme(text=element_text(family="Arial")) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", begin = .3,end = .75,)+
  theme_minimal()+ theme(plot.title = element_text(hjust = 0.5))
```


The low richness in teak is perhaps related to nutrient leaching and soil erosion ([Fernández-Moya et al 2014](https://www.sciencedirect.com/science/article/abs/pii/S0341816214002379), [Amponsah & Meyer 2008](https://www.tandfonline.com/doi/abs/10.1080/00103620009370442), [Boley et al 2009](https://www.sciencedirect.com/science/article/abs/pii/S0378112709001534)). Assessing biodiversity via richness has the caveat that rare species weigh pretty heavily on the metric. If a community has 100 individuals of one taxon but only one individual each for a further 9, then it will have a higher richness than a community composed of 8 taxa with 1 individuals each (a more diverse scenario).

### Shannon Diversity


```{r, echo=FALSE, message = FALSE, warning = FALSE}

##### Shannon diversity
ggplot(data=mean.values, aes(x=land.use, y=shannon, fill=land.use)) +
  geom_bar(stat="identity", position=position_dodge(), aes(x = factor(land.use, level = land.use)), width = .5, show.legend = FALSE)+
  #scale_fill_brewer(palette="Paired")+ 
  labs(title="Shannon diversity of soil fauna", x="Land Use Type", y = "Shannon index")+
  theme(text=element_text(family="Arial")) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", begin = .3,end = .75,)+
  theme_minimal()+ theme(plot.title = element_text(hjust = 0.5))
```


These results are somewhat surprising - Mature forest had the greatest abundance and richness in my pilot study. As of 1.7.24 these results are based only on 25 sampling points, once I get the data for the remainder the story will be more complete. I also wonder if sample 53 is single-handedly skewing these results right now?

Let's redo everything excluding sample 53:

```{r, echo=FALSE, message = FALSE, warning = FALSE}
subset.mature53 <- subset.mature[-c(1), ] 

taxa53 <- c(mean(subset.mature53$taxa),
          mean(subset.nat.regen$taxa), 
          mean(subset.reforestation$taxa),      
          mean(subset.teak$taxa),
          mean(subset.pasture$taxa))
abundance53 <- c(mean(subset.mature53$abundance),
          mean(subset.nat.regen$abundance), 
          mean(subset.reforestation$abundance),      
          mean(subset.teak$abundance),
          mean(subset.pasture$abundance))
J53 <- c(mean(subset.mature53$J),
          mean(subset.nat.regen$J), 
          mean(subset.reforestation$J),      
          mean(subset.teak$J),
          mean(subset.pasture$J))
shannon53 <- c(mean(subset.mature53$shannon),
          mean(subset.nat.regen$shannon), 
          mean(subset.reforestation$shannon),      
          mean(subset.teak$shannon),
          mean(subset.pasture$shannon))
simpson53 <- c(mean(subset.mature53$simpson),
          mean(subset.nat.regen$simpson), 
          mean(subset.reforestation$simpson),      
          mean(subset.teak$simpson),
          mean(subset.pasture$simpson))

mean.values53 <- data.frame(land.use, taxa53, abundance53, J53, shannon53, simpson53)

##### Abundance
ggplot(data=mean.values53, aes(x=land.use, y=abundance53, fill=land.use)) +
  geom_bar(stat="identity", position=position_dodge(), aes(x = factor(land.use, level = land.use)), width = .5, show.legend = FALSE)+
  #scale_fill_brewer(palette="Paired")+ 
  labs(title="Total abundance of soil fauna", x="Land Use Type", y = "Mean abundance (count/1kg dry soil)")+
  theme(text=element_text(family="Arial")) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", begin = .3,end = .75,)+
  theme_minimal()+ theme(plot.title = element_text(hjust = 0.5))

ggplot(data=mean.values53, aes(x=land.use, y=taxa53, fill=land.use)) +
  geom_bar(stat="identity", position=position_dodge(), aes(x = factor(land.use, level = land.use)), width = .5, show.legend = FALSE)+
  #scale_fill_brewer(palette="Paired")+ 
  labs(title="Taxonomic richness of soil fauna", x="Land Use Type", y = "Ordinal taxonomic richness")+
  theme(text=element_text(family="Arial")) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", begin = .3,end = .75,)+
  theme_minimal()+ theme(plot.title = element_text(hjust = 0.5))

ggplot(data=mean.values53, aes(x=land.use, y=shannon53, fill=land.use)) +
  geom_bar(stat="identity", position=position_dodge(), aes(x = factor(land.use, level = land.use)), width = .5, show.legend = FALSE)+
  #scale_fill_brewer(palette="Paired")+ 
  labs(title="Shannon diversity of soil fauna", x="Land Use Type", y = "Shannon index")+
  theme(text=element_text(family="Arial")) + 
  scale_fill_viridis(discrete=TRUE, option="viridis", begin = .3,end = .75,)+
  theme_minimal()+ theme(plot.title = element_text(hjust = 0.5))
```

Interesting. Mature forest still lags behind natural regeneration.